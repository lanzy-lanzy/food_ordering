{% extends 'cashier/base.html' %}
{% load static %}

{% block title %}Verify Reservation Payment - Cashier Dashboard{% endblock title %}

{% block page_title %}Reservation Payment Details{% endblock page_title %}
{% block page_subtitle %}Verify payment for Reservation #{{ payment.reservation.id }}{% endblock page_subtitle %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Payment Information -->
        <div class="card p-6">
            <h2 class="text-xl font-bold mb-6 flex items-center">
                <i class="fas fa-info-circle mr-2 text-food-gold"></i> Payment Information
            </h2>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Payment Method</div>
                        <div class="font-medium flex items-center">
                            <img src="/static/images/gcash_logo.png" alt="GCash" class="h-5 mr-2">
                            {{ payment.get_payment_method_display }}
                        </div>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Reference Number</div>
                        <div class="font-medium">{{ payment.reference_number }}</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Payment Type</div>
                        <div class="font-medium">
                            {% if payment.payment_type == 'FULL' %}
                            Full Payment
                            {% else %}
                            50% Deposit
                            {% endif %}
                        </div>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Amount</div>
                        <div class="font-medium text-xl text-food-gold">â‚±{{ payment.amount }}</div>
                    </div>
                </div>

                <div class="bg-gray-800 p-3 rounded-lg">
                    <div class="text-xs text-gray-500 mb-1">Payment Date</div>
                    <div class="font-medium">{{ payment.payment_date|date:"F d, Y" }} at {{ payment.payment_date|time:"H:i" }}</div>
                </div>

                <div class="bg-gray-800 p-3 rounded-lg">
                    <div class="text-xs text-gray-500 mb-1">Payment Status</div>
                    <div class="font-medium">
                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-900 text-yellow-300">
                            Pending Verification
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reservation Details -->
        <div class="card p-6">
            <h2 class="text-xl font-bold mb-6 flex items-center">
                <i class="fas fa-calendar-alt mr-2 text-food-gold"></i> Reservation Details
            </h2>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Guest Name</div>
                        <div class="font-medium">{{ payment.reservation.name }}</div>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Reservation #</div>
                        <div class="font-medium">{{ payment.reservation.id }}</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Date</div>
                        <div class="font-medium">{{ payment.reservation.date|date:"F d, Y" }}</div>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Time</div>
                        <div class="font-medium">{{ payment.reservation.time|time:"H:i" }}</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Party Size</div>
                        <div class="font-medium">{{ payment.reservation.party_size }} people</div>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">Table</div>
                        <div class="font-medium">
                            {% if payment.reservation.table_number %}
                            Table {{ payment.reservation.table_number }}
                            {% else %}
                            Not assigned
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 p-3 rounded-lg">
                    <div class="text-xs text-gray-500 mb-1">Menu Items</div>
                    <div class="text-sm">
                        {% if payment.reservation.special_requests %}
                        {{ payment.reservation.special_requests }}
                        {% else %}
                        No special requests
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Proof -->
    <div class="card p-6 mb-8">
        <h2 class="text-xl font-bold mb-6 flex items-center">
            <i class="fas fa-image mr-2 text-food-gold"></i> Payment Proof
        </h2>

        {% if payment.payment_proof %}
        <div class="flex justify-center mb-4">
            <div class="bg-gray-800 p-2 rounded-lg border border-gray-700 max-w-md">
                <img src="{{ payment.payment_proof.url }}" alt="Payment Proof" class="max-w-full h-auto rounded-lg object-contain mx-auto" style="max-height: 300px;">
            </div>
        </div>

        <div class="text-center mb-6">
            <a href="{{ payment.payment_proof.url }}" target="_blank" class="text-food-gold hover:text-food-gold-light transition duration-300">
                <i class="fas fa-external-link-alt mr-1"></i> View Full Image
            </a>
        </div>
        {% else %}
        <div class="flex items-center justify-center h-64 bg-gray-800 rounded-lg mb-6">
            <div class="text-center text-gray-500">
                <i class="fas fa-image text-4xl mb-2"></i>
                <p>No payment proof provided</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Verification Information -->
    <div class="card p-6 mb-8">
        <h2 class="text-xl font-bold mb-6 flex items-center">
            <i class="fas fa-check-circle mr-2 text-food-gold"></i> Verification Information
        </h2>

        <div class="bg-gray-800 p-4 rounded-lg mb-6">
            <div class="text-xs text-gray-500 mb-1">Payment Status</div>
            <div class="font-medium">
                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-900 text-yellow-300">
                    Pending Verification
                </span>
            </div>
            <div class="text-xs text-gray-400 mt-2">
                After verification, this payment will be marked as completed and the reservation will be confirmed.
            </div>
            <div class="mt-3 p-2 bg-gray-700 rounded border border-gray-600">
                <div class="text-xs font-medium text-food-gold mb-1">What happens after verification:</div>
                <ul class="text-xs text-gray-300 list-disc pl-4 space-y-1">
                    <li>The reservation status will be updated to <span class="font-medium text-green-400">CONFIRMED</span></li>
                    <li>The payment status will be updated to <span class="font-medium text-green-400">PAID</span> (for full payments)</li>
                    <li>If an order exists, it will be updated with the payment information</li>
                    <li>When processing this reservation, the payment will be automatically applied</li>
                </ul>
            </div>
        </div>

        <!-- Verification Actions -->
        <div class="border-t border-gray-700 pt-6">
            <h3 class="text-xl font-bold mb-6 flex items-center text-white">
                <i class="fas fa-check-double mr-2 text-food-gold"></i> Verification Actions
            </h3>

            <div class="bg-gray-800/70 p-6 rounded-lg border border-gray-700 shadow-lg mb-6">
                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 justify-center">
                    <form method="POST" action="{% url 'verify_reservation_payment' payment.id %}" class="w-full md:w-auto">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="verify">
                        <button type="submit" class="btn-success w-full md:w-auto">
                            <i class="fas fa-check-circle mr-2"></i> Verify and Complete
                        </button>
                    </form>
                    <form method="GET" action="{% url 'reject_reservation_payment' payment.id %}" class="w-full md:w-auto">
                        <button type="submit" class="btn-danger w-full md:w-auto">
                            <i class="fas fa-times-circle mr-2"></i> Reject Payment
                        </button>
                    </form>
                </div>
                <div class="text-sm text-gray-400 mt-6 text-center">
                    <i class="fas fa-info-circle mr-1 text-blue-400"></i>
                    Please verify payment details and proof before proceeding. Mark as verified to complete the process or reject if invalid.
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-8">
        <a href="{% url 'pending_reservation_payments' %}" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-md transition-colors duration-200 text-center">
            <i class="fas fa-arrow-left mr-2"></i> Back to Payments
        </a>
        <a href="{% url 'cashier_reservations_list' %}" class="bg-food-gold hover:bg-food-gold-light text-gray-900 font-bold py-3 px-6 rounded-md transition-colors duration-200 text-center">
            <i class="fas fa-calendar-alt mr-2"></i> View All Reservations
        </a>
        <a href="{% url 'cashier_reservations_list' %}?status=unprocessed&date_filter=today_and_future" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md transition-colors duration-200 text-center">
            <i class="fas fa-utensils mr-2"></i> Prepare Reservations
        </a>
        <a href="{% url 'preparation_tracker' %}" class="bg-food-gold hover:bg-food-gold-light text-gray-900 font-bold py-3 px-6 rounded-md transition-colors duration-200 text-center">
            <i class="fas fa-tasks mr-2"></i> Preparation Tracker
        </a>

    </div>
</div>
{% endblock content %}
